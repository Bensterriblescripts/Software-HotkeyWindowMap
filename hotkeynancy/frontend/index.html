<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="icon" type="image/svg+xml" href="/wails.png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="/style.css"/>
    <title>Wails App</title>
</head>
<body>
<div id="container">
    <div id="main" class="card">
    </div>
</div>
<script type="module">
    import {HWNDManager} from "/bindings/changeme";

    window.onload = async () => {
        try {
            const activeWindows = await HWNDManager.GetAllActiveWindows();
            console.log(`Active Windows: ${activeWindows}`);
            const mainDiv = document.getElementById('main');
            
            if (activeWindows.length === 0) {
                mainDiv.innerHTML = `<div class="result">No active windows found</div>`;
            } else {
                for (const window of activeWindows) {
                    const windowItem = document.createElement('div');
                    windowItem.className = 'window-item';
                    
                    windowItem.innerHTML = `
                        <div class="window-title" title="${window.Title}">${window.Title}</div>
                        <div class="window-controls" current-state="${window.WindowState}">
                            <input type="text" class="hotkey-input" placeholder="Set Hotkey">
                            <button class="borderless-btn" onclick="toggleBorderlessFullscreen(this, ${window.Handle})">Set Borderless Fullscreen</button>
                        </div>
                    `;
                    
                    windowItem.setAttribute('data-handle', window.Handle.toString());
                    windowItem.setAttribute('data-process', window.Process.toString());
                    windowItem.setAttribute('current-state', window.WindowState);
                    
                    mainDiv.appendChild(windowItem);
                }
            }
        } catch (err) {
            console.error(err);
            document.getElementById('main').innerHTML = `<div class="result">Unable to retrieve active windows</div>`;
        }
    }
    window.toggleBorderlessFullscreen = async (button, handle) => {
        try {
            const currentState = button.parentElement.getAttribute('current-state');
            console.log('Current state: ' + currentState);
            if (currentState !== null && currentState === 'Borderless Fullscreen') {
                console.log('Setting windowed');
                await HWNDManager.SetWindowed(handle);
                button.innerHTML = 'Set Borderless Fullscreen';
                button.parentElement.setAttribute('current-state', 'Windowed');  
                button.classList.remove('active');
            } else {
                console.log('Setting borderless fullscreen');
                await HWNDManager.SetBorderlessFullscreen(handle);
                button.innerHTML = 'Borderless Fullscreen';
                button.parentElement.setAttribute('current-state', 'Borderless Fullscreen');
                button.classList.add('active');
            }
        } catch (err) {
            alert(`Error: ${err}`);
            button.innerHTML = 'Error';
        }
    }
</script>
